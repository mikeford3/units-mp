

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Custom Representation Types &mdash; mp-units 0.7.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interoperability with Other Units Libraries" href="interoperability.html" />
    <link rel="prev" title="Working with Legacy Interfaces" href="legacy_interfaces.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> mp-units
          

          
          </a>

          
            
            
              <div class="version">
                0.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework.html">Framework Basics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../use_cases.html">Use Cases</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="unknown_dimensions.html">Working with Unknown Dimensions and Their Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="legacy_interfaces.html">Working with Legacy Interfaces</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Custom Representation Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-representation-concept">A <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Representation</span></code> concept</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-simplest-custom-representation-type">The Simplest Custom Representation Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#construction-of-quantities-with-custom-representation-types">Construction of Quantities with Custom Representation Types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#additional-requirements">Additional Requirements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#relational-quantity-operators">Relational Quantity Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arithmetic-quantity-operators">Arithmetic Quantity Operators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#customization-points">Customization Points</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quantity-value"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#treat-as-floating-point"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">treat_as_floating_point</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#conversions-of-quantities-with-custom-representation-types">Conversions of Quantities with Custom Representation Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="interoperability.html">Interoperability with Other Units Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="linear_algebra.html">Linear Algebra vs. Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Extending the Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="natural_units.html">Working with Natural Units</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design Deep Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/core.html">Core Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/systems.html">Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/random.html">Random</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mp-units</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../use_cases.html">Use Cases</a> &raquo;</li>
        
      <li>Using Custom Representation Types</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/use_cases/custom_representation_types.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-custom-representation-types">
<h1>Using Custom Representation Types<a class="headerlink" href="#using-custom-representation-types" title="Permalink to this headline">¶</a></h1>
<p>A custom representation type can be provided as the last <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> class template parameter.
With this a user is able to change how a quantity’s value is being represented and provide
its own custom logic for it (i.e. use a complex number or a measurement class that will handle
not only a value but also a measurement error).</p>
<div class="section" id="a-representation-concept">
<h2>A <a class="reference internal" href="../reference/core/concepts.html#_CPPv4I0EN5units14RepresentationE" title="units::Representation"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Representation</span></code></a> concept<a class="headerlink" href="#a-representation-concept" title="Permalink to this headline">¶</a></h2>
<p>To support a minimum set of <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> operations all custom representation types have to
satisfy at least the <a class="reference internal" href="../reference/core/concepts.html#_CPPv4I0EN5units14RepresentationE" title="units::Representation"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Representation</span></code></a> concept. Which means that they:</p>
<ul class="simple">
<li><p>cannot be quantities by themselves,</p></li>
<li><p>cannot be wrappers over the <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> type (i.e. <code class="docutils literal notranslate"><span class="pre">std::optional&lt;si::length&lt;si::metre&gt;&gt;</span></code>),</p></li>
<li><p>have to be regular types (e.g. they have to provide equality operators)</p></li>
<li><p>should either have common type with <code class="docutils literal notranslate"><span class="pre">std::intmax_t</span></code> which provides multiplication and
division operators</p></li>
<li><p>or <code class="xref cpp cpp-expr docutils literal notranslate"><span class="pre">T</span><span class="pre">::</span><span class="pre">value_type</span></code> must be valid, and common type of <code class="docutils literal notranslate"><span class="pre">T::value_type</span></code> and <code class="docutils literal notranslate"><span class="pre">std::intmax_t</span></code>
must at least provide multiplication and division operators with itself and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p></li>
</ul>
<p>With the above we will be able to construct quantities, convert between the units of the same
dimension, and compare them for equality.</p>
<div class="section" id="the-simplest-custom-representation-type">
<h3>The Simplest Custom Representation Type<a class="headerlink" href="#the-simplest-custom-representation-type" title="Permalink to this headline">¶</a></h3>
<p>The simplest representation type that fulfills the above requirements can look as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">my_rep</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="kt">intmax_t</span> <span class="n">value_</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">my_rep</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="k">constexpr</span> <span class="k">explicit</span> <span class="nf">my_rep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">intmax_t</span> <span class="n">v</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">:</span> <span class="n">value_</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>

  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">my_rep</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">friend</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">my_rep</span> <span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">my_rep</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">value_</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">.</span><span class="n">value_</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">friend</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">my_rep</span> <span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">my_rep</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">value_</span> <span class="o">/</span> <span class="n">rhs</span><span class="p">.</span><span class="n">value_</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Now we can put <code class="docutils literal notranslate"><span class="pre">my_rep</span></code> as the last parameter of the <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> class template and the following
code will work just fine:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static_assert</span><span class="p">(</span><span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="n">my_rep</span><span class="p">(</span><span class="mi">2&#39;000</span><span class="p">))</span> <span class="o">==</span> <span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">kilometre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="n">my_rep</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span>
</pre></div>
</div>
</div>
<div class="section" id="construction-of-quantities-with-custom-representation-types">
<h3>Construction of Quantities with Custom Representation Types<a class="headerlink" href="#construction-of-quantities-with-custom-representation-types" title="Permalink to this headline">¶</a></h3>
<p>Assuming that our custom representation type is constructible from a fundamental integral type,
let’s assume two types:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">impl</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">value_</span><span class="p">{};</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">impl</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="hll">  <span class="k">constexpr</span> <span class="nf">impl</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="n">value_</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
</span>  <span class="c1">// the rest of the representation type implementation</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">expl</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">value_</span><span class="p">{};</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">expl</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="hll">  <span class="k">constexpr</span> <span class="k">explicit</span> <span class="nf">expl</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="n">value_</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
</span>  <span class="c1">// the rest of the representation type implementation</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The difference between the above types is that <code class="docutils literal notranslate"><span class="pre">impl</span></code> class is implicitly constructible
from values of type <code class="docutils literal notranslate"><span class="pre">int</span></code> while <code class="docutils literal notranslate"><span class="pre">expl</span></code> is not. To create quantities using those as their
representation types we have to obey similar rules:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">impl</span><span class="o">&gt;</span> <span class="n">d1</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>         <span class="c1">// OK</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">expl</span><span class="o">&gt;</span> <span class="n">d2</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>         <span class="c1">// Compile-time error</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">expl</span><span class="o">&gt;</span> <span class="n">d3</span><span class="p">(</span><span class="n">expl</span><span class="p">(</span><span class="mi">123</span><span class="p">));</span>   <span class="c1">// OK</span>
</pre></div>
</div>
<p>This also applies when we want to create a quantity with a custom representation type
from a regular quantity value:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Length</span> <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">123</span><span class="n">_q_m</span><span class="p">;</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">impl</span><span class="o">&gt;</span> <span class="n">d1</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>                      <span class="c1">// OK</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">expl</span><span class="o">&gt;</span> <span class="n">d2</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>                      <span class="c1">// Compile-time error</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">expl</span><span class="o">&gt;</span> <span class="n">d3</span><span class="p">(</span><span class="n">quantity_cast</span><span class="o">&lt;</span><span class="n">expl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">));</span> <span class="c1">// OK</span>
</pre></div>
</div>
<p>The only difference here is that in this case we have to explicitly cast the <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> with
<code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity_cast</span></code> overload that scopes only on changing the representation type.</p>
</div>
</div>
<div class="section" id="additional-requirements">
<h2>Additional Requirements<a class="headerlink" href="#additional-requirements" title="Permalink to this headline">¶</a></h2>
<p>As noted in the previous chapter, the <a class="reference internal" href="../reference/core/concepts.html#_CPPv4I0EN5units14RepresentationE" title="units::Representation"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Representation</span></code></a> concept guarantees us the possibility
to construct quantities, convert between the units of the same dimension, and compare them
for equality. To provide additional <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> operations the custom representation type
have to satisfy more requirements.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The requirements described in this chapter are optional in a meaning that if someone does
not plan to use a specific quantity’s operation his/her custom representation type can
ignore (not implement/satisfy) the requirements for it.</p>
</div>
<div class="section" id="relational-quantity-operators">
<h3>Relational Quantity Operators<a class="headerlink" href="#relational-quantity-operators" title="Permalink to this headline">¶</a></h3>
<p>In case we want to to compare the values of <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> type not only for equality but
also for ordering, we have to provide a corresponding operators to our <code class="docutils literal notranslate"><span class="pre">my_rep</span></code> class.
With C++20 it is really easy to do:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">my_rep</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&lt;=&gt;</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

  <span class="c1">// ...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>With the above the following code will compile fine:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static_assert</span><span class="p">(</span><span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2&#39;000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">kilometre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="arithmetic-quantity-operators">
<h3>Arithmetic Quantity Operators<a class="headerlink" href="#arithmetic-quantity-operators" title="Permalink to this headline">¶</a></h3>
<p>In case we plan to perform arithmetic operations on our <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> type we have to provide
at least the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">my_rep</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">friend</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">my_rep</span> <span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">my_rep</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">value_</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">value_</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">friend</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">my_rep</span> <span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">my_rep</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">value_</span> <span class="o">-</span> <span class="n">rhs</span><span class="p">.</span><span class="n">value_</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Thanks to it the following code will run as expected:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static_assert</span><span class="p">(</span><span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2&#39;000</span><span class="p">)</span> <span class="o">+</span> <span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">kilometre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span>
              <span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">kilometre</span><span class="p">,</span> <span class="n">my_rep</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</pre></div>
</div>
<p>Of course, the above operators are the smallest possible set to provide support for basic
arithmetic operations. In case the user wants to use faster or more sophisticated operators
the following ones can be provided:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">my_rep</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">+</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">-</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">++</span><span class="p">();</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">--</span><span class="p">();</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">--</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">q</span><span class="p">);</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">q</span><span class="p">);</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">rhs</span><span class="p">);</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">rhs</span><span class="p">);</span>
  <span class="k">constexpr</span> <span class="n">my_rep</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">%=</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">rhs</span><span class="p">);</span>

  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">friend</span> <span class="k">constexpr</span> <span class="n">my_rep</span> <span class="k">operator</span><span class="o">%</span><span class="p">(</span><span class="n">my_rep</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">my_rep</span> <span class="n">rhs</span><span class="p">);</span>

  <span class="c1">// ...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Each of the above operators will enable a respective operator in the <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a>
type.</p>
</div>
</div>
<div class="section" id="customization-points">
<h2>Customization Points<a class="headerlink" href="#customization-points" title="Permalink to this headline">¶</a></h2>
<p>Up to now we were enabling new functionalities by adding new operations to the custom representation
type. However, we can also enable more operations and customize the engine behavior through a few
customization points.</p>
<div class="section" id="quantity-value">
<h3><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity_value</span></code><a class="headerlink" href="#quantity-value" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a> class template has a few static member functions: <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity::zero</span></code>, <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity::one</span></code>,
<code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity::min</span></code>, and <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity::max</span></code>. Those return the respective quantity values for a specific
representation type. The default implementation is provided through the <a class="reference internal" href="../reference/core/customization_points.html#_CPPv4I0EN5units15quantity_valuesE" title="units::quantity_values"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity_values</span></code></a> class
template:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="n">Representation</span> <span class="n">Rep</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">quantity_values</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="n">Rep</span> <span class="n">zero</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Rep</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="n">Rep</span> <span class="n">one</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Rep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="n">Rep</span> <span class="n">min</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">Rep</span><span class="o">&gt;::</span><span class="n">lowest</span><span class="p">();</span> <span class="p">}</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="n">Rep</span> <span class="n">max</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">Rep</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The user can provide an explicit/partial class template specialization for his/her custom
representation type and provide values that should be returned by the respective <a class="reference internal" href="../reference/core/types/quantity.html#_CPPv4I_9Dimension_6UnitOfI1DE_14RepresentationEN5units8quantityE" title="units::quantity"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">quantity</span></code></a>
operations.</p>
</div>
<div class="section" id="treat-as-floating-point">
<h3><a class="reference internal" href="../reference/core/customization_points.html#_CPPv4I0EN5units23treat_as_floating_pointE" title="units::treat_as_floating_point"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">treat_as_floating_point</span></code></a><a class="headerlink" href="#treat-as-floating-point" title="Permalink to this headline">¶</a></h3>
<p>In the <a class="reference internal" href="../framework/conversions_and_casting.html#conversions-and-casting"><span class="std std-ref">Conversions and Casting</span></a> chapter we learned
that the conversions provided by the library’s framework treat floating-point representation
types differently than the integral ones. This behavior can also be extended to the custom
representation types with <a class="reference internal" href="../reference/core/customization_points.html#_CPPv4I0EN5units23treat_as_floating_pointE" title="units::treat_as_floating_point"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">treat_as_floating_point</span></code></a> customization point which default
definition is:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="n">Representation</span> <span class="n">Rep</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">treat_as_floating_point</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">is_floating_point_v</span><span class="o">&lt;</span><span class="n">Rep</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>If our representation type should have a floating-point semantics or if it is a class
template, in which case we may not know exactly what is the final representation type,
we can specialize this variable template as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">custom</span> <span class="p">{</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">my_rep</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">value_</span><span class="p">{};</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// ...</span>
<span class="p">};</span>

<span class="p">}</span>  <span class="c1">// namespace custom</span>

<span class="k">namespace</span> <span class="n">units</span> <span class="p">{</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">treat_as_floating_point</span><span class="o">&lt;</span><span class="n">custom</span><span class="o">::</span><span class="n">my_rep</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">is_floating_point_v</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>

<span class="p">}</span>  <span class="c1">// namespace units</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Please remember that by the C++ language rules all template specializations have to be put
always in the same namespace as the primary template definition.</p>
</div>
</div>
</div>
<div class="section" id="conversions-of-quantities-with-custom-representation-types">
<h2>Conversions of Quantities with Custom Representation Types<a class="headerlink" href="#conversions-of-quantities-with-custom-representation-types" title="Permalink to this headline">¶</a></h2>
<p>In case we want to mix quantities of our Custom Representation Type with the quantities using
fundamental arithmetic types as their representation we have to provide conversion operators
in our representation type.</p>
<p>Again let’s assume two types, but this time let’s scope on conversion operators rather
than on constructors:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">impl</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">value_</span><span class="p">{};</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">  <span class="k">constexpr</span> <span class="k">operator</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">()</span> <span class="k">const</span><span class="o">&amp;</span> <span class="p">{</span> <span class="k">return</span> <span class="n">value_</span><span class="p">;</span> <span class="p">}</span>
</span>  <span class="c1">// the rest of the representation type implementation</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">expl</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">value_</span><span class="p">{};</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">  <span class="k">constexpr</span> <span class="k">explicit</span> <span class="k">operator</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">()</span> <span class="k">const</span><span class="o">&amp;</span> <span class="p">{</span> <span class="k">return</span> <span class="n">value_</span><span class="p">;</span> <span class="p">}</span>
</span>  <span class="c1">// the rest of the representation type implementation</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If we have instances of the above types we can construct quantities in the following way:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">impl</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v_impl</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">expl</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v_expl</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d1</span><span class="p">(</span><span class="n">v_impl</span><span class="p">);</span>      <span class="c1">// OK</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d2</span><span class="p">(</span><span class="n">v_expl</span><span class="p">);</span>      <span class="c1">// Compile-time error</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d3</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">v_expl</span><span class="p">);</span>  <span class="c1">// OK</span>
</pre></div>
</div>
<p>Similarly, when we have quantities of the above types we can create quantities of other
representation types with:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">impl</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">d_impl</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="n">impl</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">d_expl</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d1</span><span class="p">(</span><span class="n">d_impl</span><span class="p">);</span>                      <span class="c1">// OK</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d2</span><span class="p">(</span><span class="n">d_expl</span><span class="p">);</span>                      <span class="c1">// Compile-time error</span>
<span class="n">si</span><span class="o">::</span><span class="n">length</span><span class="o">&lt;</span><span class="n">si</span><span class="o">::</span><span class="n">metre</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d3</span><span class="p">(</span><span class="n">quantity_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d_expl</span><span class="p">));</span>  <span class="c1">// OK</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more examples of custom representation types usage please refer to the
<a class="reference internal" href="linear_algebra.html#linear-algebra-vs-quantities"><span class="std std-ref">Linear Algebra vs. Quantities</span></a> chapter and the
<a class="reference internal" href="../examples/measurement.html#measurement"><span class="std std-ref">measurement</span></a> example.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interoperability.html" class="btn btn-neutral float-right" title="Interoperability with Other Units Libraries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="legacy_interfaces.html" class="btn btn-neutral float-left" title="Working with Legacy Interfaces" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018-present, Mateusz Pusz

    </p>
  </div>
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>